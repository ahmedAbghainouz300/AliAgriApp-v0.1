<body>
    <div class="clients-container">
        <!-- Search and Add Client Section -->
        <div class="clients-header">
            <img [src]="imagePath" alt="Client" class="client-image">
            <div class="formdiv">
                <mat-form-field appearance="outline" class="matformfield">
                    <mat-label>Search</mat-label>
                    <input matInput [(ngModel)]="searchTerm" (keyup)="filterchange()" />
                </mat-form-field>
            </div>

            <button class="btn btn-outline-primary add-client-btn" (click)="onAdding=!onAdding">
                <i class="bi bi-plus-circle"></i> Add User
            </button>
        </div>
        <mat-divider style="margin: 10px 0;"></mat-divider>

        <div *ngIf="onAdding" class="add-client-form">
            <div class="form-grid">
                <mat-form-field appearance="outline" class="matformfield">
                    <mat-label>Username</mat-label>
                    <input matInput [(ngModel)]="newUser.username" />
                </mat-form-field>
                <mat-form-field appearance="outline" class="matformfield">
                    <mat-label>Password</mat-label>
                    <input matInput [(ngModel)]="newUser.password" />
                </mat-form-field>
                <mat-form-field appearance="outline" class="matformfield">
                    <mat-label>Role</mat-label>
                    <mat-select [(value)]="newUser.role">
                      <mat-option value="credit">admin</mat-option>
                      <mat-option value="cash">assistant</mat-option>
                    </mat-select>
                  </mat-form-field>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" (click)="addUser()">Save</button>
                <button class="btn btn-danger" (click)="onAdding = false">Cancel</button>
            </div>
        </div>
        <div class="mat-elevation-z8 clients-table-container">
            <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 clients-table">

                <!-- CIN Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Id </th>
                    <td mat-cell *matCellDef="let user" class="bordered-cell">
                        {{user.id}}
                    </td>
                </ng-container>

                <!-- CIN Column -->
                <ng-container matColumnDef="username">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Username </th>
                    <td mat-cell *matCellDef="let user" class="bordered-cell">
                        {{user.username}}
                        <input *ngIf="user.onediting" [(ngModel)]="editedUser.username">
                    </td>
                </ng-container>

                <!-- CIN Column -->
                <ng-container matColumnDef="password">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Password </th>
                    <td mat-cell *matCellDef="let user" class="bordered-cell">
                        {{user.password}}
                        <input *ngIf="user.onediting" [(ngModel)]="editedUser.password">
                    </td>
                </ng-container>
<!-- Telephone Column -->
                <ng-container matColumnDef="role">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Role </th>
                    <td mat-cell *matCellDef="let user" class="bordered-cell">
                        {{user.role}}
                        <mat-form-field appearance="outline" class="matformfield" *ngIf="user.onediting">
                            <mat-label>Role</mat-label>
                            <mat-select [(value)]="editedUser.role">
                              <mat-option value="admin">admin</mat-option>
                              <mat-option value="assistant">assistant</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </td>
                </ng-container>

                <!-- Telephone Column -->
                <ng-container matColumnDef="created_at">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Date d'ajout </th>
                    <td mat-cell *matCellDef="let user" class="bordered-cell">
                        {{user.created_at}}
                    </td>
                </ng-container>

                <!-- Options Column -->
                <ng-container matColumnDef="options">
                    <th mat-header-cell *matHeaderCellDef class="bordered-cell"> Options </th>
                    <td mat-cell *matCellDef="let client" class="bordered-cell">
                        <button class="btn btn-outline-primary btn-sm" *ngIf="client.onediting && Editing"
                            (click)="editUser(client);showingdetails=false;Editing=false">
                            <i class="bi bi-floppy"></i> Save
                        </button>
                        <button *ngIf="!client.onediting && !Editing" class="btn btn-outline-success btn-sm"
                            (click)="onEditing(client);Editing=true">
                            <i class="bi bi-pencil-square"></i> Edit
                        </button>
                        <button *ngIf="!client.onediting && !Editing && client.role !== 'admin'" type="button"
                            class="btn btn-outline-danger btn-sm" (click)="deleteUser(client)">
                            <i class="bi bi-trash3-fill"></i> Delete
                        </button>
                        <button *ngIf="client.onediting && Editing" type="button" class="btn btn-outline-danger btn-sm"
                            (click)="client.onediting = false;Editing= false ">
                            <i class="bi bi-trash3-fill"></i> cancel
                        </button>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row (click)="showDetails(row)" *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons
                aria-label="Select page of periodic elements">
            </mat-paginator>
        </div>
    </div>
</body>